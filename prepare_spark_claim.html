<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
    <meta name="generator" content="Jekyll v4.1.1">
    <title>Flare Spark Token claim tool for $XRP self custody holders.</title>

    <link rel="canonical" href="https://getbootstrap.com/docs/4.5/examples/starter-template/">
<!-- CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
<meta name="theme-color" content="#563d7c">


    <style>
        /*copied starter template css*/
        body {
        padding-top: 5rem;
        }
        .starter-template {
        padding: 3rem 1.5rem;
        text-align: center;
        }

      .bd-placeholder-img {
        font-size: 1.125rem;
        text-anchor: middle;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
      }

      /* need text in modal to wrap/break so we can see it */
      .modal-body p {
        word-wrap: break-word;
      }

      @media (min-width: 768px) {
        .bd-placeholder-img-lg {
          font-size: 3.5rem;
        }
      }
    </style>
    <!-- Custom styles for this template -->
    <!-- link href="starter-template.css" rel="stylesheet"-->
  </head>
  <body>
    <nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top">
  <a class="navbar-brand" href="https://flare.ghost.io/" target="_blank">Flare <img src="https://flare.ghost.io/content/images/2020/01/Flare-Logo.png" style="width:32px;height: 32px;" /> </a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="navbarsExampleDefault">
    <ul class="navbar-nav mr-auto">
      <li class="nav-item active">
        <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#">Link</a>
      </li>
      <li class="nav-item">
        <a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true">Disabled</a>
      </li>
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="dropdown01" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Dropdown</a>
        <div class="dropdown-menu" aria-labelledby="dropdown01">
          <a class="dropdown-item" href="#">Action</a>
          <a class="dropdown-item" href="#">Another action</a>
          <a class="dropdown-item" href="#">Something else here</a>
        </div>
      </li>
    </ul>
    <form class="form-inline my-2 my-lg-0">
      <input class="form-control mr-sm-2" type="text" placeholder="Search" aria-label="Search">
      <button class="btn btn-secondary my-2 my-sm-0" type="submit">Search</button>
    </form>
  </div>
</nav>

<main role="main" class="container">

    <div class="starter-template">
        <!-- h1>Bootstrap starter template</h1 -->
        <p class="lead">Not your keys ... Not your coins ...</p>
    </div>

    <div class="alert alert-info" role="alert">
        <p>This is a Flare Network / Spark token claim tool for $XRP users that self custody thier keys.</p>

        <p>This was inspired by wietse - just thought i would play with a little code.</p>

        <p><a href="https://coil.com/p/wietse/Prepare-for-claiming-your-Spark-token-Flare-Networks-a-tool-for-XUMM-XRPToolkit/NkXJQUqpi">https://coil.com/p/wietse/Prepare-for-claiming-your-Spark-token-Flare-Networks-a-tool-for-XUMM-XRPToolkit/NkXJQUqpi</a></p>

    </div>
  
    <div class="alert alert-dark" role="alert">
        <p>This page DOES NOT submit or save any information (you can use view source to verify)</p>
        <p>Your private key is only used to sign an encrypted transaction BEFORE it is transmitted via secure web socket</p>
        <p>Code is the ripple javascript library from <a href="https://xrpl.org/get-started.html/">https://xrpl.org/get-started.html</a></p>
    </div>  

    <div>

        <form id="formAccountMessageKey">

            <div class="form-group">
                <label for="xrpAddress">$XRP address</label>
                <input class="form-control" id="xrpAddress" type="text" placeholder="rsjFB8mPWqiZgPUaVh8XYqdfa59PE2d5LG" />
                
            </div>        

            <div class="form-group">
                <label for="xrpSecret">$XRP private key</label>
                <input class="form-control" id="xrpSecret" type="text" placeholder="s.........." />
                
            </div> 
            
            <div class="form-group">
                <label for="ethAddress">$ETH address</label>
                <input class="form-control" id="ethAddress" type="text" placeholder="0x........" />
                <small id="formSubmitHelp" class="form-text text-muted">No details are submitted until after encryption.</small>
            </div>
            
            <button type="submit" class="btn btn-primary" id="setAccountMessageKey">Set Message Key</button>
        </form>

    </div>

<!-- Button trigger modal --
<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal">
    Launch demo modal
  </button -->
  
  <!-- Modal -->
  <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">XRP set account MessageKey details</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body" id="exampleModalBody">
          
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          <!-- button type="button" class="btn btn-primary">Save changes</button -->
        </div>
      </div>
    </div>
  </div>    

</main><!-- /.container -->


<!-- jQuery and JS bundle w/ Popper.js -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>

<!-- Ripple javascript lib w/lodash -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.15/lodash.js"></script>
<script src="https://unpkg.com/ripple-lib@1.8.0/build/ripple-latest-min.js"></script>

<script language="javascript">

    const mainnet = new ripple.RippleAPI({
        server: 'wss://s1.ripple.com'
        //server: 'wss://s.altnet.rippletest.net'
    });


    function makeMessageKey(ethAddy){
        //https://coil.com/p/wietse/Prepare-for-claiming-your-Spark-token-Flare-Networks-a-tool-for-XUMM-XRPToolkit/NkXJQUqpi

        let prepend = '02000000000000000000000000';

        ethAddy = ethAddy.slice(2);

        return prepend + ethAddy.toUpperCase();

    }//end function



    
    $( "#formAccountMessageKey" ).submit(function( event ) {
        //alert( "Handler for .submit() called." );
        event.preventDefault(); //we're not really 'submit' the form - just pushing the data via ripple web socket

        $( "#exampleModalBody" ).html("");   //clear any old content

        const xrpAddress = $("#xrpAddress").val();
        const xrpSecret = $("#xrpSecret").val();
        const ethAddress = $("#ethAddress").val();

        (async function(api) {
            await api.connect();
        
            const settingMessage = `setting account info for ${xrpAddress}`;
            console.log( settingMessage );
            

            let messageKey = makeMessageKey( ethAddress );
        
            const messageKeyMessage = `Message Key :  ${messageKey}`;
            console.log( messageKeyMessage );

            let prepared = await api.prepareSettings(xrpAddress , {
                "messageKey" : messageKey});
        
            const preparedMessage = `Prepared : ${prepared.txJSON}`;
            console.log( preparedMessage );

            let signed = await api.sign(prepared.txJSON , xrpSecret).signedTransaction;

            const signedMessage = `Signed : ${signed}`;
            console.log( signedMessage );

            
            let final = await api.submit(signed);

            const finalMessage = 'Final : ' + JSON.stringify( final );
            console.log( finalMessage );
            

            $( "#exampleModalBody" ).append( 
                $("<p />").html( settingMessage ) 
                , $("<p />").html( messageKeyMessage ) 
                , $("<p />").html( preparedMessage ) 
                , $("<p />").html( signedMessage )
                , $("<p />").html( finalMessage )
                );

            $( "#exampleModal" ).modal('show')

            await api.disconnect();
        })(mainnet);

    });//end - formAccountMessageKey.submit
</script>
</html>
